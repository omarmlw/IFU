<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø­Ø§Ø³Ø¨Ø© IFU dz</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Tajawal&display=swap');
  body {
    font-family: 'Tajawal', sans-serif;
    padding: 20px;
    direction: rtl;
    max-width: 500px;
    margin: auto;
    background: #f5f5f5;
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  label, select, input, button {
    display: block;
    width: 100%;
    font-family: 'Tajawal', sans-serif;
    font-size: 16px;
    margin: 10px 0 5px;
    box-sizing: border-box;
  }
  select, input {
    padding: 10px;
    border: 1px solid #aaa;
    border-radius: 5px;
  }
  button {
    background-color: #007bff;
    border: none;
    color: white;
    padding: 12px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #0056b3;
  }
  #result {
    margin-top: 25px;
    font-size: 18px;
    border: 1px solid #ccc;
    padding: 20px;
    border-radius: 8px;
    background: white;
    min-height: 110px;
  }
  .error {
    color: #d33;
    font-weight: 700;
  }
  #result p {
    margin: 6px 0;
  }
  /* Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  @media (max-width: 600px) {
    body {
      padding: 15px;
      max-width: 100%;
    }
    h2 {
      font-size: 24px;
    }
    button, select, input {
      font-size: 18px;
      padding: 14px;
    }
    #result {
      font-size: 16px;
      padding: 15px;
    }
  }
</style>
</head>
<body>

<h2>Ø­Ø§Ø³Ø¨Ø© IFU dz ğŸ’°</h2>

<label for="calcType">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨:</label>
<select id="calcType">
  <option value="turnover-to-tax">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
  <option value="tax-to-turnover">Ø­Ø³Ø§Ø¨ Ø±Ù‚Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ù…Ù† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</option>
</select>

<label for="inputValue" id="inputLabel">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Ø¯Ø¬):</label>
<input type="number" id="inputValue" min="0" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ù‡Ù†Ø§" />

<label for="taxRate">Ø§Ø®ØªØ± Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</label>
<select id="taxRate">
  <option value="0.05">5%</option>
  <option value="0.12">12%</option>
  <option value="0.005">0.5% (Ù…Ù‚Ø§ÙˆÙ„ Ø°Ø§ØªÙŠ)</option>
</select>

<button id="calculateBtn">Ø§Ø­Ø³Ø¨</button>
<!-- Ø²Ø± Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© -->
<button id="saveImageBtn" style="display:none; margin-top: 10px; background-color: #28a745;">Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØµÙˆØ±Ø©</button>

<div id="result"></div>

<!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø© html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
  const calcType = document.getElementById('calcType');
  const inputLabel = document.getElementById('inputLabel');
  const inputValue = document.getElementById('inputValue');
  const taxRate = document.getElementById('taxRate');
  const calculateBtn = document.getElementById('calculateBtn');
  const resultDiv = document.getElementById('result');
  const saveImageBtn = document.getElementById('saveImageBtn');

  function formatNumber(value) {
    let parts = Number(value).toFixed(2).split('.');
    return parts[0] + ',' + parts[1];
  }

  function calculate() {
    const val = parseFloat(inputValue.value);
    const rate = parseFloat(taxRate.value);
    const type = calcType.value;

    if (inputValue.value.trim() === '') {
      resultDiv.innerHTML = '<span class="error">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ù…Ù† ÙØ¶Ù„Ùƒ</span>';
      saveImageBtn.style.display = 'none';
      return;
    }
    if (isNaN(val) || val < 0) {
      resultDiv.innerHTML = '<span class="error">Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ± Ù…Ù† ÙØ¶Ù„Ùƒ</span>';
      saveImageBtn.style.display = 'none';
      return;
    }

    let result = 0;
    let message = '';

    if (type === 'turnover-to-tax') {
      let tax = val * rate;

      if (rate === 0.005 && tax < 10000) tax = 10000;
      else if ((rate === 0.05 || rate === 0.12) && tax < 30000) tax = 30000;

      result = tax;
      message = `Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©: ${formatNumber(result)} Ø¯Ø¬`;
    } else {
      if (rate === 0.005 && val < 10000) {
        resultDiv.innerHTML = '<span class="error">Ø£Ø¯Ù†Ù‰ Ø¶Ø±ÙŠØ¨Ø© Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„ Ø§Ù„Ø°Ø§ØªÙŠ Ù‡ÙŠ 10000 Ø¯Ø¬</span>';
        saveImageBtn.style.display = 'none';
        return;
      } else if ((rate === 0.05 || rate === 0.12) && val < 30000) {
        resultDiv.innerHTML = '<span class="error">Ø£Ø¯Ù†Ù‰ Ø¶Ø±ÙŠØ¨Ø© Ù„Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¬Ø²Ø§ÙÙŠØ© Ù‡ÙŠ 30000 Ø¯Ø¬</span>';
        saveImageBtn.style.display = 'none';
        return;
      }

      let turnover = val / rate;
      result = turnover;
      message = `Ø±Ù‚Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨: ${formatNumber(result)} Ø¯Ø¬`;
    }

    const today = new Date();
    const yyyy = today.getFullYear();
    const dd = String(today.getDate()).padStart(2, '0');
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dateStr = `${dd}/${mm}/${yyyy}`;

    resultDiv.innerHTML = `
      <p>${message}</p>
      <p>âœ… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateStr}</p>
      <p>âœ… By OMAR MLW</p>
      <p>Â© ${yyyy} Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    `;

    // Ø§Ø¸Ù‡Ø§Ø± Ø²Ø± Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù†ØªÙŠØ¬Ø© ØµØ­ÙŠØ­Ø©
    saveImageBtn.style.display = 'block';
  }

  calcType.addEventListener('change', () => {
    if (calcType.value === 'turnover-to-tax') {
      inputLabel.textContent = 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Ø¯Ø¬):';
      inputValue.placeholder = 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ù‡Ù†Ø§';
    } else {
      inputLabel.textContent = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (Ø¯Ø¬):';
      inputValue.placeholder = 'Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ù‡Ù†Ø§';
    }
    resultDiv.innerHTML = '';
    inputValue.value = '';
    saveImageBtn.style.display = 'none';
  });

  calculateBtn.addEventListener('click', calculate);

  saveImageBtn.addEventListener('click', () => {
    html2canvas(resultDiv).then(canvas => {
      // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„
      const link = document.createElement('a');
      link.download = 'Ù†ØªÙŠØ¬Ø©_Ø­Ø§Ø³Ø¨Ø©_IFU_dz.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  });
</script>

</body>
</html>
